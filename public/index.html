<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Juego de Carreras</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body {
      background: linear-gradient(to bottom, #a2d4f7 0%, #ffffff 100%);
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-top: 20px;
      font-size: 2em;
      letter-spacing: 2px;
      text-shadow: 1px 1px 2px #fff;
    }
    .track-container {
      display: flex;
      justify-content: center;
      margin-top: 30px;
    }
    canvas {
      background: #e0e0e0;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      display: block;
      border: 4px solid #e57373;
    }
    .instructions {
      text-align: center;
      margin-top: 10px;
      color: #555;
      font-size: 1.1em;
      background: #fff8;
      padding: 8px 0;
      border-radius: 10px;
      width: 400px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 2px 8px #0002;
    }
    .footer {
      text-align: center;
      margin-top: 30px;
      color: #888;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>üèÅ Carrera Multijugador üèéÔ∏è</h1>
  <div class="track-container">
    <canvas id="game" width="900" height="350"></canvas>
  </div>
  <div class="instructions">
    Usa <b>‚Üê</b> y <b>‚Üí</b> para mover tu auto.<br>
    ¬°Compite con otros jugadores en tiempo real!
  </div>
  <div class="footer">
    <b>Proyecto Race Sockets</b> &copy; 2025
  </div>
  <script>
    const socket = io();
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let players = {};
    let myId = null;

    // Fondo y pista
    function drawBackground() {
      // Cielo
      ctx.fillStyle = "#a2d4f7";
      ctx.fillRect(0, 0, canvas.width, 80);

      // Ciudad
      ctx.fillStyle = "#8ecae6";
      ctx.fillRect(0, 40, canvas.width, 40);

      // Nubes
      ctx.globalAlpha = 0.4;
      ctx.fillStyle = "#fff";
      ctx.beginPath();
      ctx.arc(120, 60, 24, 0, Math.PI * 2);
      ctx.arc(150, 60, 18, 0, Math.PI * 2);
      ctx.arc(180, 60, 22, 0, Math.PI * 2);
      ctx.arc(700, 50, 28, 0, Math.PI * 2);
      ctx.arc(730, 50, 18, 0, Math.PI * 2);
      ctx.arc(760, 50, 22, 0, Math.PI * 2);
      ctx.fill();
      ctx.globalAlpha = 1;

      // √Årboles
      ctx.fillStyle = "#388e3c";
      ctx.fillRect(0, 70, canvas.width, 20);

      // Valla
      ctx.fillStyle = "#fff";
      ctx.fillRect(0, 90, canvas.width, 10);
      ctx.fillStyle = "#e57373";
      ctx.fillRect(0, 100, canvas.width, 10);

      // Poste y sem√°foro
      ctx.fillStyle = "#888";
      ctx.fillRect(820, 60, 10, 50);
      ctx.fillStyle = "#222";
      ctx.fillRect(830, 60, 30, 30);
      ctx.beginPath();
      ctx.arc(845, 70, 5, 0, Math.PI * 2); ctx.fillStyle = "#0f0"; ctx.fill();
      ctx.beginPath();
      ctx.arc(845, 85, 5, 0, Math.PI * 2); ctx.fillStyle = "#f00"; ctx.fill();
    }

    function drawTrack() {
      // Pista principal
      ctx.fillStyle = "#666";
      ctx.fillRect(40, 120, canvas.width - 80, 180);

      // L√≠neas de carril
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 3;
      for (let i = 1; i < 5; i++) {
        let y = 120 + i * 36;
        for (let x = 60; x < canvas.width - 80; x += 100) {
          ctx.beginPath();
          ctx.moveTo(x, y);
          ctx.lineTo(x + 60, y);
          ctx.stroke();
        }
      }

      // Bordes de la pista
      ctx.strokeStyle = "#FFD700";
      ctx.lineWidth = 6;
      ctx.strokeRect(40, 120, canvas.width - 80, 180);
    }

    // Autos estilizados y coloridos
    function drawCar(x, y, color, type = 0, name = "") {
      ctx.save();
      ctx.translate(x, y);

      // Sombra
      ctx.globalAlpha = 0.18;
      ctx.beginPath();
      ctx.ellipse(0, 18, 32, 10, 0, 0, Math.PI * 2);
      ctx.fillStyle = "#222";
      ctx.fill();
      ctx.globalAlpha = 1;

      // Carrocer√≠a principal
      ctx.beginPath();
      ctx.fillStyle = color;
      ctx.moveTo(-32, 0);
      ctx.quadraticCurveTo(-28, -22, 0, -22);
      ctx.quadraticCurveTo(28, -22, 32, 0);
      ctx.lineTo(32, 16);
      ctx.quadraticCurveTo(28, 28, 0, 28);
      ctx.quadraticCurveTo(-28, 28, -32, 16);
      ctx.closePath();
      ctx.fill();

      // Ventanas
      ctx.fillStyle = "#222";
      ctx.fillRect(-14, -12, 28, 10);

      // Ruedas
      ctx.fillStyle = "#222";
      ctx.beginPath();
      ctx.arc(-20, 22, 7, 0, Math.PI * 2);
      ctx.arc(20, 22, 7, 0, Math.PI * 2);
      ctx.fill();

      // Detalles de tipo de auto
      if (type === 1) { // deportivo
        ctx.fillStyle = "#fff";
        ctx.fillRect(-10, 0, 20, 6);
        ctx.fillStyle = "#222";
        ctx.fillRect(-32, 10, 8, 4);
        ctx.fillRect(24, 10, 8, 4);
      } else if (type === 2) { // camioneta
        ctx.fillStyle = "#222";
        ctx.fillRect(-32, 0, 12, 16);
      } else if (type === 3) { // compacto
        ctx.fillStyle = "#fff";
        ctx.beginPath();
        ctx.arc(0, -8, 10, Math.PI, 2 * Math.PI);
        ctx.fill();
      }

      // Nombre
      ctx.font = "bold 15px Arial";
      ctx.fillStyle = "#fff";
      ctx.textAlign = "center";
      ctx.fillText(name, 0, -28);

      ctx.restore();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBackground();
      drawTrack();

      let laneHeight = 36;
      let laneStartY = 140;
      let i = 0;
      for (let id in players) {
        let p = players[id];
        let y = laneStartY + i * laneHeight;
        // Alterna tipo de auto para variedad visual
        drawCar(p.x, y, p.color, i % 4, p.name || "Jugador");
        i++;
      }
      requestAnimationFrame(draw);
    }

    // Teclas
    document.addEventListener("keydown", (e) => {
      if (!myId) return;
      let player = players[myId];
      if (!player) return;
      if (e.key === "ArrowRight") player.x += 12;
      if (e.key === "ArrowLeft") player.x -= 12;
      if (player.x < 60) player.x = 60;
      if (player.x > canvas.width - 100) player.x = canvas.width - 100;
      socket.emit("mover", player);
    });

    // Recibe tu id del servidor
    socket.on("miId", (id) => {
      myId = id;
      players[id] = {
        x: 60,
        color: "#" + Math.floor(Math.random()*16777215).toString(16),
        name: "T√∫"
      };
      socket.emit("mover", players[id]);
    });

    // Actualizaciones de jugadores
    socket.on("actualizar", (data) => {
      players[data.id] = data;
    });

    socket.on("desconectado", (id) => {
      delete players[id];
    });

    draw();
  </script>
</body>
</html>
